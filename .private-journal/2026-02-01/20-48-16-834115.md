---
title: "8:48:16 PM - February 1, 2026"
date: 2026-02-02T01:48:16.834Z
timestamp: 1769996896834
---

## Project Notes

## Wikilink-to-DB design analysis

### Data flow today:
1. ObsidianVaultReader.load_data() → calls extract_wikilinks() per doc → metadata["wikilinks"] = list[str] (note names)
2. Two-pass in load_data: builds backlinks_map, assigns metadata["backlinks"] per doc
3. FrontmatterTransform._normalize_links() → renames to _obsidian_wikilinks, _obsidian_backlinks (underscore prefix = excluded from embedding)
4. PersistenceTransform → creates Document rows, reads _ontology_meta for metadata_json, so wikilinks/backlinks are NOT in metadata_json
5. After PersistenceTransform, each node has metadata["doc_id"] = the Document.id

### Key observations:
- extract_wikilinks does NOT strip #Section fragments from [[Note#Section]] links
- The wikilinks are note_name strings (filename stems without .md), e.g. "Graph Databases"
- Document.path is relative path within vault e.g. "Graph Databases.md" or "sub/Graph Databases.md"
- DocumentRepository.get_by_path(parent_id, path) uses exact path match
- There's no stem → path lookup function

### Design decisions needed:
1. **Where to put link resolution?** PersistenceTransform has the TODO comment. But separation of concerns says new transform. I'll argue for a separate LinkResolutionTransform because:
   - PersistenceTransform is already complex
   - Link resolution is a conceptually different operation (resolving names to IDs)
   - It MUST run after PersistenceTransform (needs doc_ids) 
   - But it also needs the same session and dataset_id context
   - It needs ALL documents to exist first before resolving

2. **DocumentLink model** - Follow BookmarkLink pattern: composite PK (source_id, target_id), with a relation enum.

3. **Name resolution**: Need to build a {note_stem: doc_id} lookup from all documents in the dataset. Note stems are the filename without .md extension. Could be ambiguous if same stem exists in different subdirs - Obsidian resolves to shortest path. For now, first-match is fine.

4. **Fragment stripping**: Should happen in FrontmatterTransform._normalize_links() when it copies wikilinks to _obsidian_wikilinks. Strip the #fragment but preserve the original for potential future use.

5. **Unresolved links**: Log them, skip them. Don't create dangling references. Could store them in metadata for diagnostic purposes.
