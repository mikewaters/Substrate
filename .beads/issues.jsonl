{"id":"substrate-1","title":"Implement persist_documents JSONL cache persistence","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-31T15:39:14.773117-05:00","created_by":"Mike Waters","updated_at":"2026-01-31T15:40:44.656331-05:00","closed_at":"2026-01-31T15:40:44.656331-05:00","close_reason":"Implemented JSONL persistence in persist_documents"}
{"id":"substrate-10","title":"Write tests for ontology schema, vault_schema, and FrontmatterTransform","description":"Unit tests for DocumentMeta (to_dict/from_dict), VaultSchema (from_frontmatter, to_document_meta, mapping), and FrontmatterTransform (title/description derivation, metadata output).","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T19:01:26.168638-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T19:50:54.954302-05:00","closed_at":"2026-02-01T19:50:54.954302-05:00","close_reason":"Integration and unit tests written for ontology schema, vault_schema, and FrontmatterTransform","dependencies":[{"issue_id":"substrate-10","depends_on_id":"substrate-8","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-11","title":"Add promote_keys to FrontmatterTransform","description":"Add promote_keys parameter that writes selected DocumentMeta fields to top-level node.metadata for downstream embedding/vector use.","status":"closed","priority":1,"issue_type":"feature","owner":"mike@mikewaters.net","created_at":"2026-02-01T19:25:27.841811-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T19:50:55.539775-05:00","closed_at":"2026-02-01T19:50:55.539775-05:00","close_reason":"promote_keys implemented and tested in FrontmatterTransform"}
{"id":"substrate-12","title":"Add DocumentLink model and DocumentLinkRepository","description":"Step 1: Add DocumentLinkKind enum, DocumentLink model with composite PK to models.py. Add outgoing_links/incoming_links relationships to Document. Add DocumentLinkRepository to repositories.py. Update exports in models.py, repositories.py, store/__init__.py.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T20:53:26.958572-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T20:55:13.659606-05:00","closed_at":"2026-02-01T20:55:13.659606-05:00","close_reason":"Closed"}
{"id":"substrate-13","title":"Add fragment stripping to FrontmatterTransform._normalize_links()","description":"Step 2: Update _normalize_links() in frontmatter.py to strip fragment identifiers from wikilinks (Note#Section -\u003e Note), dedup, and exclude empty note names after strip.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T20:53:39.018491-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T20:55:13.660429-05:00","closed_at":"2026-02-01T20:55:13.660429-05:00","close_reason":"Closed"}
{"id":"substrate-14","title":"Add LinkResolutionTransform to llama.py","description":"Step 3: Add LinkResolutionStats dataclass and LinkResolutionTransform to catalog/transform/llama.py. Runs after PersistenceTransform. Resolves wikilink note names to document IDs, creates DocumentLink rows. Update exports.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T20:53:41.51507-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T20:56:00.645473-05:00","closed_at":"2026-02-01T20:56:00.645473-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-14","depends_on_id":"substrate-12","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-15","title":"Wire LinkResolutionTransform into pipelines","description":"Step 4: Add LinkResolutionTransform after PersistenceTransform in both ingest() and ingest_dataset() methods. Remove TODO comment at line ~434 of llama.py.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T20:53:42.932416-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T20:56:29.663185-05:00","closed_at":"2026-02-01T20:56:29.663185-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-15","depends_on_id":"substrate-12","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-15","depends_on_id":"substrate-13","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-15","depends_on_id":"substrate-14","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-16","title":"Write tests for document links feature","description":"Step 5: Unit tests for DocumentLinkRepository CRUD, LinkResolutionTransform (resolution, unresolved, self-links, idempotency, stats), _normalize_links fragment stripping + dedup. Integration test: vault with cross-linking notes -\u003e ingest -\u003e query links from DB.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T20:53:45.813454-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T21:13:47.666035-05:00","closed_at":"2026-02-01T21:13:47.666035-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-16","depends_on_id":"substrate-15","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-17","title":"Add hydra-core and omegaconf dependencies","description":"Add hydra-core\u003e=1.3 and omegaconf\u003e=2.3 to src/catalog/pyproject.toml dependencies","status":"in_progress","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T21:43:35.694722-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T21:43:54.084853-05:00"}
{"id":"substrate-18","title":"Create DatasetJob models in catalog/ingest/job.py","description":"Create SourceConfig, EmbeddingConfig, PipelineConfig, DatasetJob Pydantic models with from_yaml(), to_ingest_config(), create_embed_model() methods","status":"open","priority":2,"issue_type":"feature","owner":"mike@mikewaters.net","created_at":"2026-02-01T21:43:39.847388-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T21:43:39.847388-05:00","dependencies":[{"issue_id":"substrate-18","depends_on_id":"substrate-17","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-19","title":"Add ingest_from_config() to IngestPipeline","description":"Add ingest_from_config(config_path) method to IngestPipeline that loads YAML via Hydra, validates into DatasetJob, and runs the full pipeline with configurable caching/embedding","status":"open","priority":2,"issue_type":"feature","owner":"mike@mikewaters.net","created_at":"2026-02-01T21:43:46.904158-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T21:43:46.904158-05:00","dependencies":[{"issue_id":"substrate-19","depends_on_id":"substrate-18","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-2","title":"Create ObsidianEnrichmentTransform","description":"New TransformComponent in catalog/transform/obsidian.py that derives title, description, and link metadata from ObsidianReader node metadata","status":"closed","priority":2,"issue_type":"feature","owner":"mike@mikewaters.net","created_at":"2026-02-01T17:32:49.242776-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T17:34:19.868703-05:00","closed_at":"2026-02-01T17:34:19.868703-05:00","close_reason":"Closed"}
{"id":"substrate-20","title":"Write ADR-0001 for Hydra job config","description":"Document the decision to use Hydra for YAML-based job configuration in adrs/ADR-0001-hydra-job-config.md","status":"in_progress","priority":3,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T21:43:46.998395-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T21:43:54.19179-05:00"}
{"id":"substrate-21","title":"Write unit tests for DatasetJob and ingest_from_config","description":"Unit tests for DatasetJob model validation, from_yaml loading, to_ingest_config conversion, create_embed_model, and PipelineConfig to DocstoreStrategy mapping","status":"open","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T21:43:47.091076-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T21:43:47.091076-05:00","dependencies":[{"issue_id":"substrate-21","depends_on_id":"substrate-19","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-22","title":"Centralize Obsidian integration into catalog.integrations.obsidian","status":"closed","priority":1,"issue_type":"feature","owner":"mike@mikewaters.net","created_at":"2026-02-02T15:11:32.928815-05:00","created_by":"Mike Waters","updated_at":"2026-02-02T15:23:42.398433-05:00","closed_at":"2026-02-02T15:23:42.398433-05:00","close_reason":"All Obsidian-specific code centralized into catalog.integrations.obsidian. 102 tests passing."}
{"id":"substrate-23","title":"Fix test compatibility after Qdrant migration","description":"After migrating from SimpleVectorStore to QdrantVectorStore, several tests fail due to:\n1. Qdrant requires UUID point IDs but ChunkPersistenceTransform uses hash:seq format\n2. Test fixtures use in-memory Qdrant which may have different behavior\n3. Some tests don't properly set up chunk_fts table\n\nFollow-up from Qdrant migration (catalog-26 through catalog-30).","status":"open","priority":2,"issue_type":"bug","owner":"mike@mikewaters.net","created_at":"2026-02-04T20:32:51.62461-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T20:32:51.62461-05:00"}
{"id":"substrate-24","title":"Epic: RAG v2 Phase 1 - Infrastructure \u0026 Core Pipeline","description":"Phase 1 establishes foundational infrastructure for RAG v2:\n\n**Features:**\n1.1 RAGv2Settings - Environment-driven configuration in catalog/core/settings.py\n1.2 LLM Result Caching - Cache for expansion/rerank results in catalog/store/llm_cache.py  \n1.3 Resilient Embedding - Batch-to-single fallback in catalog/embedding/resilient.py\n1.4 Resilient Chunking - Token-to-char fallback in catalog/transform/splitter.py\n1.5 Embedding Prefix Transform - Nomic-style prefixes in catalog/transform/embedding.py\n1.6 V2 Ingestion Pipeline - Combines all transforms in catalog/ingest/pipelines_v2.py\n\n**Dependencies:** None (foundational)\n**Tests:** tests/rag_v2/test_transforms.py, test_cache.py, test_ingestion_v2.py","status":"closed","priority":1,"issue_type":"feature","owner":"mike@mikewaters.net","created_at":"2026-02-04T20:50:34.671525-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:05:41.091195-05:00","closed_at":"2026-02-04T21:05:41.091195-05:00","close_reason":"Closed"}
{"id":"substrate-25","title":"Epic: RAG v2 Phase 2 - Search Pipeline","description":"Phase 2 implements core search functionality:\n\n**Features:**\n2.1 Query Expansion System - LLM-powered query variants in catalog/search/query_expansion.py\n2.2 RRF Postprocessors - TopRankBonus, KeywordChunkSelector, PerDocDedupe, ScoreNormalizer in catalog/search/postprocessors.py\n2.3 Weighted RRF Hybrid Retriever - Custom RRF with weights in catalog/search/hybrid_v2.py\n2.4 Cached Reranker - Cache wrapper for reranker in catalog/llm/reranker.py\n2.5 Snippet Formatting - Line-number citations in catalog/search/formatting.py\n2.6 Search Service V2 - Unified orchestrator in catalog/search/service_v2.py\n\n**Dependencies:** Phase 1 (1.1 Settings, 1.2 LLM Cache)\n**Tests:** tests/rag_v2/test_query_expansion.py, test_postprocessors.py, test_hybrid_retrieval.py","status":"closed","priority":1,"issue_type":"feature","owner":"mike@mikewaters.net","created_at":"2026-02-04T20:50:42.685282-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:16:52.869493-05:00","closed_at":"2026-02-04T21:16:52.869493-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-25","depends_on_id":"substrate-24","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-26","title":"Epic: RAG v2 Phase 3 - MCP \u0026 API","description":"Phase 3 exposes v2 search via Model Context Protocol:\n\n**Features:**\n3.1 MCP Tool Definitions - 6 tools (catalog_search, catalog_vsearch, catalog_query, catalog_get, catalog_multi_get, catalog_status) in catalog/api/mcp/tools.py\n3.2 MCP Server Implementation - stdio protocol server in catalog/api/mcp/server.py\n3.3 MCP Resources - URI-based document access in catalog/api/mcp/resources.py\n\n**Dependencies:** Phase 2 (2.6 SearchServiceV2)\n**Tests:** tests/rag_v2/test_mcp_tools.py, test_mcp_server.py","status":"closed","priority":1,"issue_type":"feature","owner":"mike@mikewaters.net","created_at":"2026-02-04T20:50:45.97897-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:28:05.195377-05:00","closed_at":"2026-02-04T21:27:00.136039-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-26","depends_on_id":"substrate-25","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-27","title":"Epic: RAG v2 Phase 4 - Evaluation \u0026 Rollout","description":"Phase 4 establishes evaluation framework and rollout mechanisms:\n\n**Features:**\n4.1 Golden Query Evaluation Suite - Hit@K metrics in tests/rag_v2/test_eval.py\n4.2 Golden Query Dataset - 24+ queries in tests/rag_v2/fixtures/golden_queries.json\n4.3 Side-by-Side Comparison Mode - v1 vs v2 comparison in catalog/search/comparison.py\n4.4 Evaluation CLI Commands - golden, compare, compare-batch in catalog/cli/eval.py\n\n**Dependencies:** Phase 2 (2.6 SearchServiceV2)\n**Tests:** tests/rag_v2/test_evaluation.py, test_comparison.py, test_eval_integration.py","status":"closed","priority":1,"issue_type":"feature","owner":"mike@mikewaters.net","created_at":"2026-02-04T20:50:49.193375-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:40:31.489892-05:00","closed_at":"2026-02-04T21:40:31.489892-05:00","close_reason":"All Phase 4 tasks (4.1-4.4) completed: golden query evaluation, dataset, comparison mode, and CLI commands with 151 tests passing","dependencies":[{"issue_id":"substrate-27","depends_on_id":"substrate-25","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-28","title":"1.1 RAGv2Settings - Configuration System","description":"Add RAGv2Settings to catalog/core/settings.py with environment variable support (IDX_RAG_V2__*).\n\n**Config knobs:**\n- Chunking: chunk_size=800, chunk_overlap=120, chunk_fallback_enabled, chunk_chars_per_token=4\n- Embedding: embed_batch_size=32, embed_fallback_enabled, embed_prefix_query, embed_prefix_doc\n- Query expansion: expansion_enabled, expansion_max_lex=3, expansion_max_vec=3, expansion_include_hyde\n- RRF fusion: rrf_k=60, rrf_original_weight=2.0, rrf_expansion_weight=1.0, rrf_rank1_bonus=0.05, rrf_rank23_bonus=0.02\n- Reranking: rerank_top_n=10, rerank_candidates=40, rerank_cache_enabled\n- Caching: cache_ttl_hours=168\n- Retrieval: vector_top_k=20, fts_top_k=20, fusion_top_k=30\n- Snippets: snippet_max_lines=10, snippet_context_lines=2\n\n**Acceptance:**\n- RAGv2Settings class with all config knobs\n- Environment variable override support\n- Default values match TypeScript QMD system\n- Unit tests for settings loading","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T20:51:04.933442-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T20:53:16.667239-05:00","closed_at":"2026-02-04T20:53:16.667239-05:00","close_reason":"Closed"}
{"id":"substrate-29","title":"1.2 LLM Result Caching","description":"Create LLM cache in catalog/store/llm_cache.py for expansion and rerank results.\n\n**Schema:**\n- llm_cache_v2 table: cache_key (PK), cache_type, result_json, created_at\n\n**Implementation:**\n- LLMCacheEntry SQLAlchemy model\n- LLMCache class with get_expansion/set_expansion, get_rerank/set_rerank\n- SHA-256 cache key strategy\n- TTL-based expiration (default 1 week)\n\n**Acceptance:**\n- LLMCacheEntry SQLAlchemy model\n- LLMCache class with get/set methods\n- TTL-based expiration\n- Unit tests for cache operations\n- Integration test with database","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T20:51:08.464157-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T20:59:43.638628-05:00","closed_at":"2026-02-04T20:59:43.638628-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-29","depends_on_id":"substrate-28","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-3","title":"Update PersistenceTransform for title/description","description":"Update PersistenceTransform._process_node() to read title and description from node metadata and pass to doc_repo.create() and apply on update path","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T17:32:53.961846-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T17:34:19.868757-05:00","closed_at":"2026-02-01T17:34:19.868757-05:00","close_reason":"Closed"}
{"id":"substrate-30","title":"1.3 Resilient Embedding Infrastructure","description":"Create ResilientEmbedding wrapper in catalog/embedding/resilient.py.\n\n**Implementation:**\n- ResilientEmbedding(BaseEmbedding) wrapper\n- Falls back to single-item embedding on batch errors\n- Logging of fallback events\n- Update get_embed_model(resilient: bool = False) factory function\n\n**Acceptance:**\n- ResilientEmbedding wrapper class\n- Batch-to-single fallback logic\n- Logging of fallback events\n- Updated factory function\n- Unit tests with mocked failures","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T20:51:11.073236-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T20:59:43.638691-05:00","closed_at":"2026-02-04T20:59:43.638691-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-30","depends_on_id":"substrate-28","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-31","title":"1.4 Resilient Text Chunking","description":"Create ResilientSplitter in catalog/transform/splitter.py (update existing).\n\n**Implementation:**\n- ResilientSplitter(TransformComponent) \n- Token-based splitter with char-based fallback\n- Uses TokenTextSplitter primary, SentenceSplitter fallback\n- Configurable fallback enable/disable\n\n**Acceptance:**\n- ResilientSplitter TransformComponent\n- Token-to-char fallback logic\n- Configurable fallback enable/disable\n- Logging of fallback events\n- Unit tests with various document types","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T20:51:13.449155-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T20:59:43.638696-05:00","closed_at":"2026-02-04T20:59:43.638696-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-31","depends_on_id":"substrate-28","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-32","title":"1.5 Embedding Prefix Transform","description":"Create EmbeddingPrefixTransform in catalog/transform/embedding.py.\n\n**Implementation:**\n- EmbeddingPrefixTransform(TransformComponent)\n- Applies Nomic-style prefix: 'title: {title} | text: '\n- Configurable prefix template\n- Preserves original text in metadata\n\n**Acceptance:**\n- EmbeddingPrefixTransform class\n- Configurable prefix template\n- Original text preservation in metadata\n- Unit tests verifying prefix application","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T20:51:16.36366-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T20:59:43.638699-05:00","closed_at":"2026-02-04T20:59:43.638699-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-32","depends_on_id":"substrate-28","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-33","title":"1.6 V2 Ingestion Pipeline","description":"Create DatasetIngestPipelineV2 in catalog/ingest/pipelines_v2.py.\n\n**Implementation:**\n- DatasetIngestPipelineV2 class\n- Combines: PersistenceTransform -\u003e ResilientSplitter -\u003e ChunkPersistenceTransform -\u003e EmbeddingPrefixTransform\n- Docstore-based deduplication (UPSERTS_AND_DELETE)\n- Pipeline state persistence\n- Reads config from get_settings().rag_v2\n\n**Acceptance:**\n- DatasetIngestPipelineV2 class\n- Integration with all Phase 1 transforms\n- Docstore-based deduplication\n- Pipeline state persistence\n- Integration test with sample documents","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T20:51:18.987945-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:05:41.017413-05:00","closed_at":"2026-02-04T21:05:41.017413-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-33","depends_on_id":"substrate-30","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-33","depends_on_id":"substrate-31","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-33","depends_on_id":"substrate-32","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-34","title":"2.1 Query Expansion System","description":"Create QueryExpansionTransform in catalog/search/query_expansion.py.\n\n**Data Model:**\n- QueryExpansionResult dataclass: original, lex_expansions, vec_expansions, hyde_passage\n\n**Implementation:**\n- QueryExpansionTransform(QueryTransform)\n- LLM-powered expansion via structured prompts (lex:/vec:/hyde: tags)\n- Quality filtering (require original query terms)\n- Cache integration with LLMCache\n- Graceful fallback on LLM failure\n\n**Prompt location:** catalog/llm/prompts.py (QUERY_EXPANSION_PROMPT)\n\n**Tests:** tests/rag_v2/test_query_expansion.py","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T21:06:40.239778-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:13:52.490194-05:00","closed_at":"2026-02-04T21:13:52.490194-05:00","close_reason":"Closed"}
{"id":"substrate-35","title":"2.2 RRF Postprocessors","description":"Create postprocessors in catalog/search/postprocessors.py.\n\n**Classes:**\n- TopRankBonusPostprocessor: Add bonus scores to top-ranked results\n- KeywordChunkSelector: Select best chunk per document based on keyword hits  \n- PerDocDedupePostprocessor: Collapse multiple chunks per document\n- ScoreNormalizerPostprocessor: Normalize scores to 0-1 range\n\nAll implement BaseNodePostprocessor interface.\n\n**Tests:** tests/rag_v2/test_postprocessors.py","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T21:06:43.462441-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:13:52.490268-05:00","closed_at":"2026-02-04T21:13:52.490268-05:00","close_reason":"Closed"}
{"id":"substrate-36","title":"2.3 Weighted RRF Hybrid Retriever","description":"Create WeightedRRFRetriever in catalog/search/hybrid_v2.py.\n\n**Implementation:**\n- WeightedRRFRetriever(BaseRetriever)\n- Per-query weighting: weight / (k + rank + 1)\n- Configurable weights for original vs expansion queries\n- HybridRetrieverV2 factory class\n\n**Integration:**\n- Works with existing FTSChunkRetriever and VectorStoreManager\n- Dataset filtering support\n\n**Tests:** tests/rag_v2/test_hybrid_retrieval.py","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T21:06:46.517972-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:13:52.490298-05:00","closed_at":"2026-02-04T21:13:52.490298-05:00","close_reason":"Closed"}
{"id":"substrate-37","title":"2.4 Cached Reranker","description":"Create CachedReranker wrapper in catalog/llm/reranker.py (update existing).\n\n**Implementation:**\n- CachedReranker wraps existing Reranker\n- Per-document cache lookup by content_hash\n- Partial cache hits (mix cached and uncached)\n- Uses LLMCache for persistence\n\n**Tests:** Add tests to tests/rag_v2/test_reranker.py","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T21:06:48.809032-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:13:52.490302-05:00","closed_at":"2026-02-04T21:13:52.490302-05:00","close_reason":"Closed"}
{"id":"substrate-38","title":"2.5 Snippet Formatting","description":"Create snippet utilities in catalog/search/formatting.py.\n\n**Implementation:**\n- Snippet dataclass: text, start_line, end_line, header\n- extract_snippet() function: Calculate line numbers, build diff-style header\n\n**Tests:** tests/rag_v2/test_formatting.py","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T21:06:50.705317-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:13:52.490305-05:00","closed_at":"2026-02-04T21:13:52.490305-05:00","close_reason":"Closed"}
{"id":"substrate-39","title":"2.6 Search Service V2","description":"Create SearchServiceV2 in catalog/search/service_v2.py.\n\n**Implementation:**\n- SearchServiceV2 class: Unified orchestrator for v2 search\n- Methods: search(), search_fts(), search_vector(), search_hybrid()\n- Integration with all Phase 2 components\n- Convenience function search_v2()\n\n**Dependencies:** Requires 2.1-2.5 to be complete\n\n**Tests:** tests/rag_v2/test_search_service_v2.py","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T21:06:53.301505-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:16:52.795713-05:00","closed_at":"2026-02-04T21:16:52.795713-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-39","depends_on_id":"substrate-34","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-39","depends_on_id":"substrate-35","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-39","depends_on_id":"substrate-36","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-39","depends_on_id":"substrate-37","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-39","depends_on_id":"substrate-38","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-4","title":"Update transform __init__.py exports","description":"Add ObsidianEnrichmentTransform to catalog/transform/__init__.py imports and __all__","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T17:32:54.87355-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T17:34:19.868762-05:00","closed_at":"2026-02-01T17:34:19.868762-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-4","depends_on_id":"substrate-2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-40","title":"3.1 MCP Tool Definitions","description":"Create MCP tools in catalog/api/mcp/tools.py.\n\n**Tools:**\n- catalog_search: BM25 keyword search\n- catalog_vsearch: Semantic vector search\n- catalog_query: Hybrid search with RRF and optional reranking\n- catalog_get: Get document by path or ID\n- catalog_multi_get: Get multiple documents by glob pattern\n- catalog_status: Get index health info\n\n**Tests:** tests/rag_v2/test_mcp_tools.py","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T21:17:37.428913-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:28:05.118815-05:00","closed_at":"2026-02-04T21:26:43.698708-05:00","close_reason":"Closed"}
{"id":"substrate-41","title":"3.2 MCP Server Implementation","description":"Create MCP server in catalog/api/mcp/server.py.\n\n**Implementation:**\n- MCPServer class with stdio protocol\n- tools/list, tools/call handlers\n- resources/list, resources/read handlers\n- Entry point for Claude Desktop integration\n\n**Tests:** tests/rag_v2/test_mcp_server.py","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T21:17:39.71233-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:28:05.11888-05:00","closed_at":"2026-02-04T21:26:52.609695-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-41","depends_on_id":"substrate-40","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-42","title":"3.3 MCP Resources","description":"Create MCP resources in catalog/api/mcp/resources.py.\n\n**Implementation:**\n- list_resources(): List datasets as catalog:// URIs\n- read_resource(): Read document by URI\n\n**URI scheme:**\n- catalog://{dataset} - List documents in dataset\n- catalog://{dataset}/{path} - Get specific document\n\n**Tests:** tests/rag_v2/test_mcp_resources.py","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T21:17:42.090995-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:28:05.118884-05:00","closed_at":"2026-02-04T21:26:56.33997-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-42","depends_on_id":"substrate-41","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-43","title":"4.1 Golden Query Evaluation Suite","description":"Create evaluation framework in tests/rag_v2/test_eval.py.\n\n**Data Models:**\n- GoldenQuery dataclass: query, expected_docs, difficulty, retriever_types\n- EvalResult dataclass: query, difficulty, retriever_type, hit_at_k metrics\n\n**Functions:**\n- evaluate_golden_queries(): Run evaluation and return Hit@K metrics\n- EVAL_THRESHOLDS config for automated regression testing","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T21:28:51.806695-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:36:03.280538-05:00","closed_at":"2026-02-04T21:36:03.280538-05:00","close_reason":"Implemented golden query evaluation, dataset, and comparison modules with full test coverage"}
{"id":"substrate-44","title":"4.2 Golden Query Dataset","description":"Create golden_queries.json fixture in tests/rag_v2/fixtures/.\n\n**Requirements:**\n- 24+ golden queries across difficulty levels\n- Categories: easy (6), medium (6), hard (6), fusion (6)\n- Clear expected document mappings\n- Notes explaining each query's purpose","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T21:28:53.950961-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:36:03.280601-05:00","closed_at":"2026-02-04T21:36:03.280601-05:00","close_reason":"Implemented golden query evaluation, dataset, and comparison modules with full test coverage"}
{"id":"substrate-45","title":"4.3 Side-by-Side Comparison Mode","description":"Create comparison mode in catalog/search/comparison.py.\n\n**Implementation:**\n- ComparisonResult dataclass with v1/v2 results, timing, overlap metrics\n- SearchComparison class for running comparisons\n- Jaccard similarity calculation\n- Spearman rank correlation\n- Summary report generation","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T21:28:56.348359-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:36:03.280606-05:00","closed_at":"2026-02-04T21:36:03.280606-05:00","close_reason":"Implemented golden query evaluation, dataset, and comparison modules with full test coverage"}
{"id":"substrate-46","title":"4.4 Evaluation CLI Commands","description":"Create CLI commands in catalog/cli/eval.py.\n\n**Commands:**\n- golden: Run golden query evaluation\n- compare: Compare v1 vs v2 for single query\n- compare-batch: Compare multiple queries","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-04T21:28:57.582409-05:00","created_by":"Mike Waters","updated_at":"2026-02-04T21:40:15.737835-05:00","closed_at":"2026-02-04T21:40:15.737835-05:00","close_reason":"Implemented CLI commands (golden, compare, compare-batch) with 23 tests passing","dependencies":[{"issue_id":"substrate-46","depends_on_id":"substrate-43","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-46","depends_on_id":"substrate-45","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-47","title":"Fix pipeline v2: skip chunks/vectors for unchanged documents","description":"PersistenceTransform skips DB writes for unchanged docs but still passes all nodes downstream. This causes ChunkPersistenceTransform and embed_model to re-process unchanged documents. Fix: filter skipped nodes out of the returned list in PersistenceTransform.__call__.","status":"closed","priority":1,"issue_type":"bug","owner":"mike@mikewaters.net","created_at":"2026-02-05T19:02:00.952118-05:00","created_by":"Mike Waters","updated_at":"2026-02-05T19:05:39.006496-05:00","closed_at":"2026-02-05T19:05:39.006496-05:00","close_reason":"PersistenceTransform now filters skipped nodes from output list, preventing unnecessary chunking/embedding of unchanged documents"}
{"id":"substrate-48","title":"Add LinkML schema for catalog store models","description":"Create a LinkML schema file under src/catalog/docs that mirrors src/catalog/catalog/store/models.py.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-05T19:33:38.705561-05:00","created_by":"Mike Waters","updated_at":"2026-02-05T19:34:20.284769-05:00","closed_at":"2026-02-05T19:34:20.284769-05:00","close_reason":"Closed"}
{"id":"substrate-49","title":"Heptabase integration: refactor ObsidianVaultReader link extraction","description":"Make link extraction overridable by adding _extract_links method to ObsidianVaultReader","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-05T19:39:41.98703-05:00","created_by":"Mike Waters","updated_at":"2026-02-05T19:40:20.134364-05:00","closed_at":"2026-02-05T19:40:20.134364-05:00","close_reason":"Closed"}
{"id":"substrate-5","title":"Write tests for ObsidianEnrichmentTransform","description":"Write unit tests for the new ObsidianEnrichmentTransform covering title derivation priority, description derivation, and link normalization","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T17:32:55.949002-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T19:50:57.14173-05:00","closed_at":"2026-02-01T19:50:57.14173-05:00","close_reason":"Tests for ObsidianEnrichmentTransform logic covered in FrontmatterTransform tests","dependencies":[{"issue_id":"substrate-5","depends_on_id":"substrate-2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-50","title":"Heptabase integration: add MARKDOWN_LINK to DocumentLinkKind","description":"Add MARKDOWN_LINK enum value to DocumentLinkKind in store/models.py and store/models/catalog.py","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-05T19:39:42.092442-05:00","created_by":"Mike Waters","updated_at":"2026-02-05T19:40:20.134436-05:00","closed_at":"2026-02-05T19:40:20.134436-05:00","close_reason":"Closed"}
{"id":"substrate-51","title":"Heptabase integration: make LinkResolutionTransform link kind configurable","description":"Add link_kind parameter to LinkResolutionTransform.__init__, default WIKILINK","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-05T19:39:42.19869-05:00","created_by":"Mike Waters","updated_at":"2026-02-05T19:40:38.153446-05:00","closed_at":"2026-02-05T19:40:38.153446-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-51","depends_on_id":"substrate-50","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-52","title":"Heptabase integration: create heptabase module and registration","description":"Create catalog/integrations/heptabase/ with reader, schemas, vault_schema, __init__ and register in integrations/__init__","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-05T19:39:42.30466-05:00","created_by":"Mike Waters","updated_at":"2026-02-05T19:41:38.635723-05:00","closed_at":"2026-02-05T19:41:38.635723-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-52","depends_on_id":"substrate-49","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-52","depends_on_id":"substrate-51","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-53","title":"Heptabase integration: write tests","description":"Unit tests for link extraction, config validation, and source registration","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-05T19:39:42.408477-05:00","created_by":"Mike Waters","updated_at":"2026-02-05T19:49:24.547551-05:00","closed_at":"2026-02-05T19:49:24.547551-05:00","close_reason":"Tests written and passing - committed in 24ff448","dependencies":[{"issue_id":"substrate-53","depends_on_id":"substrate-52","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-54","title":"Add catalog JSON Schema doc generator script","description":"Create a utility script under scripts/ that inspects catalog.store models and emits a combined JSON Schema doc for documentation. Parallelizable: none (single script + docs update).","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-05T19:46:18.177957-05:00","created_by":"Mike Waters","updated_at":"2026-02-05T19:52:07.165988-05:00","closed_at":"2026-02-05T19:52:07.165988-05:00","close_reason":"Closed"}
{"id":"substrate-55","title":"Add DocumentRepository.deactivate_missing() method","description":"New repo method that sets active=False for all documents in a dataset whose path is not in a given set of paths. Used for post-pipeline deletion sync.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T17:15:09.952128-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T17:20:20.823187-05:00","closed_at":"2026-02-07T17:20:20.823187-05:00","close_reason":"Closed"}
{"id":"substrate-56","title":"Simplify PersistenceTransform to always-persist","description":"Remove content_hash skip logic from _process_node(). Remove _force parameter. Every doc that reaches the transform is new or changed (LlamaIndex filters upstream). Update _compute_content_hash to include metadata or use node.hash directly.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T17:15:11.733235-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T17:20:20.823521-05:00","closed_at":"2026-02-07T17:20:20.823521-05:00","close_reason":"Closed"}
{"id":"substrate-57","title":"Add post-pipeline deletion sync and vector store guard","description":"In DatasetIngestPipelineV2.ingest(), after pipeline.run(): (1) call deactivate_missing to mark deleted docs inactive in SQLite, (2) assert vector store is attached when using UPSERTS_AND_DELETE, (3) derive skipped count from batch_size - processed.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T17:15:13.55048-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T17:22:31.351671-05:00","closed_at":"2026-02-07T17:22:31.351671-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-57","depends_on_id":"substrate-55","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-57","depends_on_id":"substrate-56","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-58","title":"Add tests for docstore-based change detection","description":"Test that metadata-only changes trigger reprocessing. Test deletion sync marks removed docs inactive. Test vector store guard assertion.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T17:15:14.735572-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T17:23:48.012933-05:00","closed_at":"2026-02-07T17:23:48.012933-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-58","depends_on_id":"substrate-57","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-59","title":"Add if_modified_since filtering to sources and job","description":"Added if_modified_since: datetime | None param to ObsidianVaultSource, HeptabaseVaultSource, their configs, SourceConfig, DatasetSourceConfig, and the factory/dispatch wiring.","status":"closed","priority":2,"issue_type":"feature","owner":"mike@mikewaters.net","created_at":"2026-02-07T18:12:48.066781-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T18:12:52.048852-05:00","closed_at":"2026-02-07T18:12:52.048852-05:00","close_reason":"Implemented and tested"}
{"id":"substrate-6","title":"Create DocumentMeta dataclass in catalog/ontology/schema.py","description":"Create the DocumentMeta dataclass with title, description, tags, categories, author, extra fields. Include to_dict() and from_dict() methods.","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T19:01:15.427096-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T19:03:43.844628-05:00","closed_at":"2026-02-01T19:03:43.844628-05:00","close_reason":"Closed"}
{"id":"substrate-60","title":"Add last_ingested_at to Dataset model and schema","description":"Add last_ingested_at column to Dataset ORM, DatasetInfo Pydantic schema, and wire through _to_info methods","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T18:24:12.223284-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T18:24:58.540026-05:00","closed_at":"2026-02-07T18:24:58.540026-05:00","close_reason":"Closed"}
{"id":"substrate-61","title":"Add incremental flag to config chain","description":"Add incremental: bool = False to SourceConfig, DatasetSourceConfig, and wire through obsidian/heptabase factories","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T18:24:12.317734-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T18:24:58.540355-05:00","closed_at":"2026-02-07T18:24:58.540355-05:00","close_reason":"Closed"}
{"id":"substrate-62","title":"Resolve incremental in pipeline and stamp last_ingested_at","description":"Restructure pipeline to resolve incremental before source creation, skip deletion sync, downgrade docstore strategy, and stamp last_ingested_at after success","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T18:24:12.409095-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T18:26:11.24996-05:00","closed_at":"2026-02-07T18:26:11.24996-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-62","depends_on_id":"substrate-60","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-62","depends_on_id":"substrate-61","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-63","title":"Write tests for incremental ingestion","description":"Test: new dataset full run, existing dataset uses last_ingested_at, explicit if_modified_since wins, deletion sync skipped, UPSERTS strategy, last_ingested_at stamped","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T18:24:12.499684-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T18:28:00.637499-05:00","closed_at":"2026-02-07T18:28:00.637499-05:00","close_reason":"All 11 incremental tests + 19 source/config tests passing","dependencies":[{"issue_id":"substrate-63","depends_on_id":"substrate-62","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-64","title":"Review src/catalog/tests for ingestion-to-analysis integration tests","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T18:38:25.119143-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T18:41:41.841733-05:00","closed_at":"2026-02-07T18:41:41.841733-05:00","close_reason":"Closed"}
{"id":"substrate-65","title":"Fix FTSSearch.search_with_scores kwarg mismatch","description":"search/fts.py:100 passes dataset_filter= to FTSManager.search_with_scores(), but the method signature in store/fts.py accepts parent_filter=. Fix: rename the kwarg in the caller from dataset_filter= to parent_filter=. Unblocks 10 failing integration tests across test_hybrid_search.py, test_ingest_fts.py, and test_vector_hybrid_rerank.py.","status":"closed","priority":2,"issue_type":"bug","owner":"mike@mikewaters.net","created_at":"2026-02-07T18:51:59.905102-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T19:01:11.080002-05:00","closed_at":"2026-02-07T19:01:11.080002-05:00","close_reason":"Closed"}
{"id":"substrate-66","title":"Fix cleanup_stale_documents calling DirectorySource.enumerate()","description":"store/cleanup.py:279 calls source.enumerate() but DirectorySource only has a .documents cached_property. Fix: change cleanup.py to iterate source.documents and access doc.metadata['relative_path'] instead of doc.relative_path. Unblocks 4 failing tests in test_ingest_fts.py and test_hybrid_ingestion.py (TestSoftDeleteBehavior, TestDeletePropagation).","status":"closed","priority":2,"issue_type":"bug","owner":"mike@mikewaters.net","created_at":"2026-02-07T18:52:02.06808-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T19:01:11.080328-05:00","closed_at":"2026-02-07T19:01:11.080328-05:00","close_reason":"Closed"}
{"id":"substrate-67","title":"Fix test_node_id_format assertion for UUID5 node IDs","description":"test_hybrid_ingestion.py::TestIdempotentIngestion::test_node_id_format expects hash:seq format but ChunkPersistenceTransform generates UUID5 (required for Qdrant compatibility). Fix: update the test assertion to validate UUID format instead of hash:seq. The idempotency check (test_reingest_produces_same_node_ids) already passes and validates the real requirement.","status":"closed","priority":3,"issue_type":"bug","owner":"mike@mikewaters.net","created_at":"2026-02-07T18:52:04.567006-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T19:01:11.080333-05:00","closed_at":"2026-02-07T19:01:11.080333-05:00","close_reason":"Closed"}
{"id":"substrate-68","title":"Draft behave BDD scaffolding for ingest FTS scenario","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T18:55:27.704798-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T18:56:46.856949-05:00","closed_at":"2026-02-07T18:56:46.856949-05:00","close_reason":"Closed"}
{"id":"substrate-69","title":"Draft detailed eval harness documentation for catalog","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T19:03:55.979316-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T19:06:09.543093-05:00","closed_at":"2026-02-07T19:06:09.543093-05:00","close_reason":"Closed"}
{"id":"substrate-7","title":"Create VaultSchema Pydantic base in catalog/ontology/vault_schema.py","description":"Create VaultSchema Pydantic model with maps_to field annotations, from_frontmatter(), to_document_meta() methods, and extra=allow config.","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T19:01:19.551975-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T19:03:43.845178-05:00","closed_at":"2026-02-01T19:03:43.845178-05:00","close_reason":"Closed"}
{"id":"substrate-70","title":"Refactor BDD ingest FTS scenario to higher-level steps","description":"Update ingest_fts.feature and step definitions to remove low-level DB/dataset details, use named corpus, and keep assertions intact. Parallelizable with: create vault-mini corpus files.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T19:04:37.227883-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T19:07:19.854147-05:00","closed_at":"2026-02-07T19:07:19.854147-05:00","close_reason":"Closed"}
{"id":"substrate-71","title":"Create vault-mini test corpus for BDD","description":"Add a small named corpus (vault-mini) under src/catalog/tests/corpus with 4 markdown files matching the FTS scenario expectations. Parallelizable with: refactor BDD steps/feature.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T19:04:41.51767-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T19:06:38.132002-05:00","closed_at":"2026-02-07T19:06:38.132002-05:00","close_reason":"Closed"}
{"id":"substrate-72","title":"Create e2e test module for Catalog","description":"Refactor 6 integration tests into src/catalog/tests/e2e/ with real infrastructure (SQLite + Qdrant), persistent output, env-driven settings override.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T19:22:47.069393-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T19:26:49.712594-05:00","closed_at":"2026-02-07T19:26:49.712594-05:00","close_reason":"All 6 e2e tests implemented and passing"}
{"id":"substrate-73","title":"Write eval harness implementation plan","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T19:25:04.756438-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T19:25:39.631125-05:00","closed_at":"2026-02-07T19:25:39.631125-05:00","close_reason":"Closed"}
{"id":"substrate-74","title":"Add project runbook","description":"Create docs/RUNBOOK.md with key developer commands and documentation generation steps.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T19:37:13.868258-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T19:37:41.919056-05:00","closed_at":"2026-02-07T19:37:41.919056-05:00","close_reason":"Closed"}
{"id":"substrate-75","title":"Promote Pipeline v2 and RAG v2 to mainline, delete v1","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T19:37:43.812481-05:00","created_by":"Mike Waters","updated_at":"2026-02-07T20:03:46.798789-05:00","closed_at":"2026-02-07T20:03:46.798789-05:00","close_reason":"Promoted v2 pipeline, search, and settings to mainline. Deleted v1 deprecated code. All 865 tests pass."}
{"id":"substrate-76","title":"Define OntologyMappingSpec protocol and OntologyMapper transform","description":"Add new ontology mapping interface + transform (likely in catalog/ontology or catalog/transform). Consider attrs dataclass/protocol for spec, and mapping contract for sources. Parallelizable with obsidian/heptabase schema updates and docs/tests if interface shape is agreed.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T20:04:26.484388-05:00","created_by":"Mike Waters","updated_at":"2026-02-08T19:05:33.499923-05:00","closed_at":"2026-02-08T19:05:33.499923-05:00","close_reason":"Closed"}
{"id":"substrate-77","title":"Wire OntologyMapper into ingestion pipeline and source transforms","description":"Replace pre-persist FrontmatterTransform with OntologyMapper in DatasetIngestPipeline; pass source vault_spec into mapper; update source transforms signatures/configs. Touches ingest/pipelines.py and obsidian/heptabase sources. Likely sequential after spec/transform task.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T20:04:30.832613-05:00","created_by":"Mike Waters","updated_at":"2026-02-08T19:05:33.500325-05:00","closed_at":"2026-02-08T19:05:33.500325-05:00","close_reason":"Closed"}
{"id":"substrate-78","title":"Update obsidian/heptabase vault specs to implement OntologyMappingSpec","description":"Adapt VaultSchema/HeptabaseVaultSchema (or replacement spec classes) to implement new OntologyMappingSpec interface. Ensure config loaders accept new spec type/path. Can be parallelized with tests/docs if interface is fixed.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T20:04:33.685269-05:00","created_by":"Mike Waters","updated_at":"2026-02-08T19:05:33.500329-05:00","closed_at":"2026-02-08T19:05:33.500329-05:00","close_reason":"Closed"}
{"id":"substrate-79","title":"Add ADR + update tests/docs for OntologyMapper mapping","description":"Create ADR in docs/adr for replacing FrontmatterTransform with OntologyMapper; update unit/integration tests and any docs/config examples. Parallelizable with code implementation once APIs are set.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-07T20:04:36.317646-05:00","created_by":"Mike Waters","updated_at":"2026-02-08T19:05:33.500335-05:00","closed_at":"2026-02-08T19:05:33.500335-05:00","close_reason":"Closed"}
{"id":"substrate-8","title":"Create FrontmatterTransform in catalog/transform/frontmatter.py","description":"Create FrontmatterTransform that validates frontmatter through VaultSchema, converts to DocumentMeta, derives title/description, absorbs ObsidianEnrichmentTransform logic.","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T19:01:21.342069-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T19:04:22.663399-05:00","closed_at":"2026-02-01T19:04:22.663399-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-8","depends_on_id":"substrate-6","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-8","depends_on_id":"substrate-7","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-80","title":"Enable pytest --testmon for catalog tests","description":"Running make agent-test in src/catalog fails: pytest not found on PATH and uv run pytest --testmon errors with unrecognized argument. Ensure pytest-testmon plugin is installed/available or adjust the differential test command.","status":"open","priority":2,"issue_type":"bug","owner":"mike@mikewaters.net","created_at":"2026-02-08T19:08:11.260186-05:00","created_by":"Mike Waters","updated_at":"2026-02-08T19:08:11.260186-05:00"}
{"id":"substrate-81","title":"Ingest format/media_type/subject through catalog pipeline","description":"Add pipeline support for format, media_type, subject fields on Resource: sources set format/media_type from file extension, OntologyMapper extracts subject from frontmatter, PersistenceTransform persists all three.","status":"closed","priority":2,"issue_type":"feature","owner":"mike@mikewaters.net","created_at":"2026-02-10T19:53:28.576817-05:00","created_by":"Mike Waters","updated_at":"2026-02-10T19:56:42.047322-05:00","closed_at":"2026-02-10T19:56:42.047322-05:00","close_reason":"Implemented format/media_type/subject ingestion through pipeline: sources set format/media_type from file extension, OntologyMapper extracts subject from frontmatter, PersistenceTransform persists all three to Resource columns."}
{"id":"substrate-82","title":"Implement search-improver skill","description":"Create the search-improver skill package per docs/features/search_improver_skill.md. The skill iteratively diagnoses retrieval failures, builds controlled corpora, runs deterministic experiments, and proposes validated improvements. Must reuse existing eval harness, search service, and ingestion scripts.","status":"closed","priority":2,"issue_type":"feature","owner":"mike@mikewaters.net","created_at":"2026-02-15T18:32:47.451485-05:00","created_by":"Mike Waters","updated_at":"2026-02-15T18:52:06.78258-05:00","closed_at":"2026-02-15T18:52:06.78258-05:00","close_reason":"All 9 subtasks complete. search-improver skill fully implemented: SKILL.md, openai.yaml, 6 scripts (build_corpus, run_experiment, build_metrics, compare_baseline, bootstrap_round, scenarios), 3 reference docs. Pipeline verified end-to-end.","dependencies":[{"issue_id":"substrate-82","depends_on_id":"substrate-83","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-82","depends_on_id":"substrate-84","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-82","depends_on_id":"substrate-85","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-82","depends_on_id":"substrate-86","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-82","depends_on_id":"substrate-87","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-82","depends_on_id":"substrate-88","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-82","depends_on_id":"substrate-89","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-82","depends_on_id":"substrate-90","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-82","depends_on_id":"substrate-91","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-83","title":"Scaffold skill package structure","description":"Create .claude/skills/search-improver/ with SKILL.md (name, description, trigger phrases for search debugging, retrieval regressions, corpus design, hybrid tuning, eval gating), agents/openai.yaml placeholder, scripts/ dir, and references/ dir. No README or changelog.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-15T18:33:00.308205-05:00","created_by":"Mike Waters","updated_at":"2026-02-15T18:38:49.032932-05:00","closed_at":"2026-02-15T18:38:49.032932-05:00","close_reason":"Closed"}
{"id":"substrate-84","title":"Build corpus builder script","description":"Create scripts/build_corpus.py that builds curated, synthetic, or fixture corpora under 100 docs. Supports three modes: curated (extract 20-80 md docs from vault), synthetic (heading trap, exact-match trap, near-duplicate, metadata-only templates), fixture (stable version-controlled). Outputs corpus.jsonl (doc_id, title, body, frontmatter), queries.json (query list with expected doc IDs and target modes), and README.md. Deterministic for same inputs/seed, clear CLI with --help.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-15T18:33:18.970172-05:00","created_by":"Mike Waters","updated_at":"2026-02-15T18:38:49.116189-05:00","closed_at":"2026-02-15T18:38:49.116189-05:00","close_reason":"Closed"}
{"id":"substrate-85","title":"Build retrieval experiment runner script","description":"Create scripts/run_experiment.py that executes ingestion + retrieval across all 4 modes (BM25/FTS, vector, hybrid RRF, hybrid+rerank) using existing code paths (scripts/ingest_obsidian_vault.py, scripts/run_search_eval.py, catalog eval golden). Outputs run.json (timestamp, git metadata, corpus/query pointers, settings), results.jsonl (per-query results), metrics.json (aggregated metrics), trace.jsonl (per-query rank trace with channel contributions). Must be deterministic and offline-friendly.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-15T18:33:19.063797-05:00","created_by":"Mike Waters","updated_at":"2026-02-15T18:48:00.605544-05:00","closed_at":"2026-02-15T18:48:00.605544-05:00","close_reason":"run_experiment.py written (891 lines), imports catalog modules directly, runs 4 modes (fts/vector/hybrid/hybrid_rerank), outputs run.json/results.jsonl/metrics.json/trace.jsonl, syntax-verified","dependencies":[{"issue_id":"substrate-85","depends_on_id":"substrate-84","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-86","title":"Build metrics and trace builder script","description":"Create scripts/build_metrics.py that derives aggregate metrics (Recall@k, MRR@k, nDCG@k, heading-dominance rate) and per-query traces from raw retrieval results. Trace must include: query, mode, rank, doc_id, node_id, score_final, score_components (fts/vector/rrf/rerank), source_channel_ranks (bm25 rank, vector rank, fused rank). Extend existing eval harness if metrics are missing rather than reimplementing.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-15T18:33:19.156933-05:00","created_by":"Mike Waters","updated_at":"2026-02-15T18:50:30.204757-05:00","closed_at":"2026-02-15T18:50:30.204757-05:00","close_reason":"build_metrics.py written with enrich (nDCG@k + heading-dominance rate) and summary subcommands, syntax-verified","dependencies":[{"issue_id":"substrate-86","depends_on_id":"substrate-85","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-87","title":"Build baseline comparator script","description":"Create scripts/compare_baseline.py that compares current metrics.json against a baseline. Supports configurable thresholds per metric. Returns non-zero exit code on regression. Works as a local regression gate command.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-15T18:33:19.249494-05:00","created_by":"Mike Waters","updated_at":"2026-02-15T18:50:30.278466-05:00","closed_at":"2026-02-15T18:50:30.278466-05:00","close_reason":"compare_baseline.py written with configurable thresholds, strict mode, comparison.json output, exit-code regression gate, syntax-verified","dependencies":[{"issue_id":"substrate-87","depends_on_id":"substrate-86","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-88","title":"Build beads round bootstrap script","description":"Create scripts/bootstrap_round.py that creates/updates beads round tasks for the improvement loop. Creates parent campaign task and round subtasks (plan, implement, evaluate). Updates task status as work progresses. Closes tasks with experiment folder path references. Enforces stopping criteria: 3 rounds default, early stop if no metric improvement for 2 consecutive rounds, stop when regression gates green and target failure resolved.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-15T18:33:19.338418-05:00","created_by":"Mike Waters","updated_at":"2026-02-15T18:38:49.188397-05:00","closed_at":"2026-02-15T18:38:49.188397-05:00","close_reason":"Closed"}
{"id":"substrate-89","title":"Write skill references for corpus format, metrics schema, and loop contract","description":"Create references/ files inside the skill package: corpus-format.md (canonical corpus.jsonl + queries.json + README schema), metrics-schema.md (required metrics, trace fields, regression gate config), loop-contract.md (Plan/Instrument/Experiment/Reflect/Queue cycle, stopping criteria, recommendation output contract). These are focused reference files the skill agent consults during execution.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-15T18:33:31.47301-05:00","created_by":"Mike Waters","updated_at":"2026-02-15T18:38:49.25813-05:00","closed_at":"2026-02-15T18:38:49.25813-05:00","close_reason":"Closed"}
{"id":"substrate-9","title":"Wire FrontmatterTransform into pipeline plumbing","description":"Update IngestObsidianConfig, ObsidianVaultSource, create_source, PersistenceTransform._get_metadata_json(), pipelines.py, and transform/__init__.py exports. Delete ontology/mapper.py and transform/ontology.py.","status":"closed","priority":1,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-01T19:01:24.171871-05:00","created_by":"Mike Waters","updated_at":"2026-02-01T19:05:30.457976-05:00","closed_at":"2026-02-01T19:05:30.457976-05:00","close_reason":"Closed","dependencies":[{"issue_id":"substrate-9","depends_on_id":"substrate-8","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-90","title":"Implement scenario coverage: 4 minimum test scenarios","description":"Define and make runnable the 4 required scenarios: (1) heading bias regression, (2) exact-match identifiers (numbers/SKU/IDs), (3) semantic paraphrase retrieval, (4) near-duplicate ranking/diversity. Each scenario needs: failure hypothesis, query set, expected retrieval behavior, metric targets. Build these as corpus + query fixtures that the experiment runner can consume.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-15T18:33:31.569126-05:00","created_by":"Mike Waters","updated_at":"2026-02-15T18:48:01.221853-05:00","closed_at":"2026-02-15T18:48:01.221853-05:00","close_reason":"scenarios.py written with 4 scenarios (heading_bias, exact_match, semantic_para, near_duplicate), 35 docs + 23 queries total, format compliance validated against corpus-format.md","dependencies":[{"issue_id":"substrate-90","depends_on_id":"substrate-84","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"substrate-91","title":"Create experiment ledger structure and end-to-end validation","description":"Set up experiments/ directory structure (experiments/YYYY-MM-DD/slug/). Validate the full loop end-to-end: build corpus -\u003e run experiment -\u003e emit metrics/traces -\u003e generate recommendation -\u003e compare baseline -\u003e track in beads. Each experiment folder must contain: spec.md, run.json, metrics.json, results.jsonl, trace.jsonl, recommendations.md, diff.patch or commit ref. This is the Definition of Done validation.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-02-15T18:33:31.696292-05:00","created_by":"Mike Waters","updated_at":"2026-02-15T18:52:01.31618-05:00","closed_at":"2026-02-15T18:52:01.31618-05:00","close_reason":"Experiment ledger convention added to SKILL.md with full pipeline documentation. Fixed difficulty field bug in run_experiment.py results.jsonl output. All 6 scripts parse and pipeline interfaces verified compatible: build_corpus -\u003e run_experiment -\u003e build_metrics -\u003e compare_baseline.","dependencies":[{"issue_id":"substrate-91","depends_on_id":"substrate-85","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-91","depends_on_id":"substrate-86","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-91","depends_on_id":"substrate-87","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-91","depends_on_id":"substrate-88","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"substrate-91","depends_on_id":"substrate-90","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
